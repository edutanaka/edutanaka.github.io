<!DOCTYPE html>
<html lang="pt_BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>Dashboard APP</h1>
    <div class="dashboard-content">
        <div class="loading">Loading dashboard...</div>
    </div>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .dashboard-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #c33;
        }
        
        pre {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 14px;
        }
    </style>
    
    <script>
        (function() {
            console.log('Initializing Chatwoot Dashboard App');
            
            // Function to handle the response from Chatwoot
            function handleChatwootResponse(data) {
                console.log('Received data from Chatwoot:', data);
                updateDashboard(data);
            }

            // Function to update the dashboard with received data
            function updateDashboard(data) {
                const dashboardElement = document.querySelector('.dashboard-content');
                if (dashboardElement && data) {
                    dashboardElement.innerHTML = `
                        <div class="dashboard-card">
                            <h3>Dashboard Information</h3>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            }

            // Send message to Chatwoot parent window
            try {
                window.parent.postMessage({
                    type: 'chatwoot-dashboard-app:fetch-info'
                }, window.location.origin);
                
                // Listen for response from Chatwoot
                window.addEventListener('message', function(event) {
                    if (event.origin !== window.location.origin) {
                        console.warn('Received message from untrusted origin:', event.origin);
                        return;
                    }
                    
                    if (event.data && event.data.type === 'chatwoot-dashboard-app:response') {
                        handleChatwootResponse(event.data.payload);
                    }
                });
                
            } catch (error) {
                console.error('Error communicating with Chatwoot:', error);
                document.querySelector('.dashboard-content').innerHTML = 
                    '<div class="error">Error connecting to Chatwoot dashboard</div>';
            }
        })();
    </script>
    
</body>
</html>